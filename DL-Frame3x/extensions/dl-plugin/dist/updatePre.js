"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updatePre = updatePre;
const fs = require("fs");
const path = require("path");
const preName = require("../config.json").preName;
const pathstr = path.join(Editor.Project.path, preName);
var uuidToTree = {};
var dataArrs = '';
function updatePre() {
    dataArrs = `import { Node } from 'cc';\n`;
    dataArrs += `declare global {`;
    const files = fs.readdirSync(pathstr);
    files.map(filepar => {
        if (filepar.indexOf('.meta') == -1) {
            let newDir = path.join(pathstr, filepar);
            let filesPar = fs.readdirSync(newDir);
            filesPar.forEach(file => {
                if (file.indexOf('.meta') == -1 && file.indexOf('.prefab') > -1) {
                    let newDirPath = path.join(newDir, file);
                    let name = file.split('.')[0];
                    readFileContent(newDirPath, name);
                }
            });
        }
    });
    dataArrs += `\n}`;
    let pt = path.join(Editor.Project.path, 'type_pre.d.ts');
    fs.writeFileSync(pt, dataArrs);
}
function readFileContent(fileDir, fileName) {
    let content = (0, fs.readFileSync)(fileDir, 'utf8');
    let arrayContent = formatName(JSON.parse(content));
    let typeTree = `\n   type tree_${fileName} = {`;
    arrayContent.forEach((name) => {
        typeTree += `\n      "${name}": Node,`;
    });
    typeTree += `\n   }`;
    dataArrs += typeTree;
}
// 处理节点名字，找出其名字并给原数据赋值
function formatName(content) {
    let nodeNames = [];
    content.forEach(element => {
        if (element["__type__"] == "cc.Node" && element["_name"] && element["_prefab"]) {
            nodeNames.push(element["_name"]);
        }
    });
    return nodeNames;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlUHJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc291cmNlL3VwZGF0ZVByZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQVNBLDhCQXNCQztBQS9CRCxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDekIsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzdCLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUNsRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBRXhELElBQUksVUFBVSxHQUF5QixFQUFFLENBQUM7QUFFMUMsSUFBSSxRQUFRLEdBQVcsRUFBRSxDQUFDO0FBRTFCLFNBQWdCLFNBQVM7SUFDckIsUUFBUSxHQUFHLDhCQUE4QixDQUFDO0lBQzFDLFFBQVEsSUFBSSxrQkFBa0IsQ0FBQztJQUUvQixNQUFNLEtBQUssR0FBYSxFQUFFLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2hELEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDaEIsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDakMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDekMsSUFBSSxRQUFRLEdBQWEsRUFBRSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoRCxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNwQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO29CQUM5RCxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDekMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDOUIsZUFBZSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFDdEMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxJQUFJLEtBQUssQ0FBQztJQUNsQixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQ3pELEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FBQyxPQUFlLEVBQUUsUUFBZ0I7SUFDdEQsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNwRCxJQUFJLFlBQVksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ25ELElBQUksUUFBUSxHQUFHLGtCQUFrQixRQUFRLE1BQU0sQ0FBQztJQUNoRCxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7UUFDMUIsUUFBUSxJQUFJLFlBQVksSUFBSSxVQUFVLENBQUM7SUFDM0MsQ0FBQyxDQUFDLENBQUE7SUFDRixRQUFRLElBQUksUUFBUSxDQUFDO0lBQ3JCLFFBQVEsSUFBSSxRQUFRLENBQUM7QUFDekIsQ0FBQztBQUVELHNCQUFzQjtBQUN0QixTQUFTLFVBQVUsQ0FBQyxPQUErQjtJQUMvQyxJQUFJLFNBQVMsR0FBYSxFQUFFLENBQUM7SUFDN0IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtRQUN0QixJQUFJLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxTQUFTLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQzdFLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDckMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxTQUFTLENBQUM7QUFDckIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGZzID0gcmVxdWlyZShcImZzXCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHByZU5hbWUgPSByZXF1aXJlKFwiLi4vY29uZmlnLmpzb25cIikucHJlTmFtZTtcclxuY29uc3QgcGF0aHN0ciA9IHBhdGguam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCBwcmVOYW1lKTtcclxuXHJcbnZhciB1dWlkVG9UcmVlOiB7IFtrOiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG5cclxudmFyIGRhdGFBcnJzOiBzdHJpbmcgPSAnJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVQcmUoKSB7XHJcbiAgICBkYXRhQXJycyA9IGBpbXBvcnQgeyBOb2RlIH0gZnJvbSAnY2MnO1xcbmA7XHJcbiAgICBkYXRhQXJycyArPSBgZGVjbGFyZSBnbG9iYWwge2A7XHJcblxyXG4gICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gZnMucmVhZGRpclN5bmMocGF0aHN0cik7XHJcbiAgICBmaWxlcy5tYXAoZmlsZXBhciA9PiB7XHJcbiAgICAgICAgaWYgKGZpbGVwYXIuaW5kZXhPZignLm1ldGEnKSA9PSAtMSkge1xyXG4gICAgICAgICAgICBsZXQgbmV3RGlyID0gcGF0aC5qb2luKHBhdGhzdHIsIGZpbGVwYXIpO1xyXG4gICAgICAgICAgICBsZXQgZmlsZXNQYXI6IHN0cmluZ1tdID0gZnMucmVhZGRpclN5bmMobmV3RGlyKTtcclxuICAgICAgICAgICAgZmlsZXNQYXIuZm9yRWFjaChmaWxlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChmaWxlLmluZGV4T2YoJy5tZXRhJykgPT0gLTEgJiYgZmlsZS5pbmRleE9mKCcucHJlZmFiJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdEaXJQYXRoID0gcGF0aC5qb2luKG5ld0RpciwgZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5hbWUgPSBmaWxlLnNwbGl0KCcuJylbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVhZEZpbGVDb250ZW50KG5ld0RpclBhdGgsIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBkYXRhQXJycyArPSBgXFxufWA7XHJcbiAgICBsZXQgcHQgPSBwYXRoLmpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgJ3R5cGVfcHJlLmQudHMnKTtcclxuICAgIGZzLndyaXRlRmlsZVN5bmMocHQsIGRhdGFBcnJzKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVhZEZpbGVDb250ZW50KGZpbGVEaXI6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZykge1xyXG4gICAgbGV0IGNvbnRlbnQgPSAoMCwgZnMucmVhZEZpbGVTeW5jKShmaWxlRGlyLCAndXRmOCcpO1xyXG4gICAgbGV0IGFycmF5Q29udGVudCA9IGZvcm1hdE5hbWUoSlNPTi5wYXJzZShjb250ZW50KSk7XHJcbiAgICBsZXQgdHlwZVRyZWUgPSBgXFxuICAgdHlwZSB0cmVlXyR7ZmlsZU5hbWV9ID0ge2A7XHJcbiAgICBhcnJheUNvbnRlbnQuZm9yRWFjaCgobmFtZSkgPT4ge1xyXG4gICAgICAgIHR5cGVUcmVlICs9IGBcXG4gICAgICBcIiR7bmFtZX1cIjogTm9kZSxgO1xyXG4gICAgfSlcclxuICAgIHR5cGVUcmVlICs9IGBcXG4gICB9YDtcclxuICAgIGRhdGFBcnJzICs9IHR5cGVUcmVlO1xyXG59XHJcblxyXG4vLyDlpITnkIboioLngrnlkI3lrZfvvIzmib7lh7rlhbblkI3lrZflubbnu5nljp/mlbDmja7otYvlgLxcclxuZnVuY3Rpb24gZm9ybWF0TmFtZShjb250ZW50OiBbeyBbazogc3RyaW5nXTogYW55IH1dKSB7XHJcbiAgICBsZXQgbm9kZU5hbWVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29udGVudC5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgIGlmIChlbGVtZW50W1wiX190eXBlX19cIl0gPT0gXCJjYy5Ob2RlXCIgJiYgZWxlbWVudFtcIl9uYW1lXCJdICYmIGVsZW1lbnRbXCJfcHJlZmFiXCJdKSB7XHJcbiAgICAgICAgICAgIG5vZGVOYW1lcy5wdXNoKGVsZW1lbnRbXCJfbmFtZVwiXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbm9kZU5hbWVzO1xyXG59Il19