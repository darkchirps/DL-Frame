"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateSpr = updateSpr;
const fs = require("fs");
const path = require("path");
const uiDir = require("../config.json").sprName;
const pathstr = path.join(Editor.Project.path, uiDir);
var UILogicDict = {};
var UIClassDict = {};
var importArr = [];
/**
 * 将Excel文件转换为JSON格式
 * @param excelPath Excel文件路径
 * @param outputDir 输出目录
 * @returns 转换结果
 */
function updateSpr() {
    importArr = [];
    importArr = [`import { UIClass } from './assets/appDL/Manager/UIClass';\n`];
    const files = fs.readdirSync(pathstr);
    files.map(filepar => {
        if (!filepar.endsWith('.meta')) {
            if (filepar.split('.')[1] == 'ts') {
                readTs('', filepar);
            }
            else {
                let filesPar = fs.readdirSync(pathstr + '/' + filepar);
                filesPar.forEach(file => {
                    if (file.indexOf('.meta') == -1 && file.indexOf('.ts') != -1) {
                        readTs(filepar, file);
                    }
                });
            }
        }
    });
    let ts = importArr.join("");
    ts += `
interface UIClassDict { }
`;
    for (var className in UILogicDict) {
        ts += `interface ${className}Class extends UIClass {
    uiScr: ${UILogicDict[className]}
}
`;
    }
    ts += `
interface UIClassDict {
`;
    for (var baseName in UIClassDict) {
        ts += `    ${baseName}: ${UIClassDict[baseName]}\n`;
    }
    ts += `}`;
    let pt = path.join(Editor.Project.path, 'type_spr.d.ts');
    fs.writeFileSync(pt, ts);
}
function readTs(par, tsName) {
    let name = tsName.split('.')[0];
    let fileName = "";
    if (par == '') {
        fileName = '/' + tsName;
    }
    else {
        fileName = '/' + par + '/' + tsName;
    }
    let str = fs.readFileSync(pathstr + "/" + fileName, 'utf-8');
    // 只处理继承 UIScr 的类
    const classReg = /export\s+(?:default\s+)?(?:abstract\s+)?class\s+(\w+)\s+extends\s+UIScr(?:<[^>]+>)?/;
    let match = classReg.exec(str);
    if (!match)
        return; //不继承 UIScr 直接退出
    var arr = [];
    var UILogicName = name;
    arr.push(UILogicName);
    UILogicDict[name] = name;
    UIClassDict[name] = name + "Class";
    importArr.push(`import { ${arr.join(', ')} } from './${uiDir}/${par}/${name}';\n`);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlU3ByLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc291cmNlL3VwZGF0ZVNwci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQWVBLDhCQXNDQztBQXJERCxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDekIsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzdCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUNoRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBRXRELElBQUksV0FBVyxHQUF5QixFQUFFLENBQUM7QUFDM0MsSUFBSSxXQUFXLEdBQXlCLEVBQUUsQ0FBQztBQUMzQyxJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7QUFFbkI7Ozs7O0dBS0c7QUFDSCxTQUFnQixTQUFTO0lBQ3JCLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDZixTQUFTLEdBQUcsQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO0lBQzVFLE1BQU0sS0FBSyxHQUFhLEVBQUUsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEQsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRTtRQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQzdCLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFDaEMsTUFBTSxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUN4QixDQUFDO2lCQUFNLENBQUM7Z0JBQ0osSUFBSSxRQUFRLEdBQWEsRUFBRSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEdBQUcsR0FBRyxHQUFHLE9BQU8sQ0FBQyxDQUFDO2dCQUNqRSxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUNwQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDO3dCQUMzRCxNQUFNLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO29CQUMxQixDQUFDO2dCQUNMLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksRUFBRSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDM0IsRUFBRSxJQUFJOztDQUVULENBQUE7SUFDRyxLQUFLLElBQUksU0FBUyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ2hDLEVBQUUsSUFBSSxhQUFhLFNBQVM7YUFDdkIsV0FBVyxDQUFDLFNBQVMsQ0FBQzs7Q0FFbEMsQ0FBQTtJQUNHLENBQUM7SUFDRCxFQUFFLElBQUk7O0NBRVQsQ0FBQTtJQUNHLEtBQUssSUFBSSxRQUFRLElBQUksV0FBVyxFQUFFLENBQUM7UUFDL0IsRUFBRSxJQUFJLE9BQU8sUUFBUSxLQUFLLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFBO0lBQ3ZELENBQUM7SUFDRCxFQUFFLElBQUksR0FBRyxDQUFBO0lBQ1QsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxlQUFlLENBQUMsQ0FBQTtJQUN4RCxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUM3QixDQUFDO0FBQ0QsU0FBUyxNQUFNLENBQUMsR0FBVyxFQUFFLE1BQWM7SUFDdkMsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoQyxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFDbEIsSUFBSSxHQUFHLElBQUksRUFBRSxFQUFFLENBQUM7UUFDWixRQUFRLEdBQUcsR0FBRyxHQUFHLE1BQU0sQ0FBQztJQUM1QixDQUFDO1NBQU0sQ0FBQztRQUNKLFFBQVEsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxNQUFNLENBQUM7SUFDeEMsQ0FBQztJQUNELElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxHQUFHLEdBQUcsR0FBRyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDN0QsaUJBQWlCO0lBQ2pCLE1BQU0sUUFBUSxHQUFHLHFGQUFxRixDQUFDO0lBQ3ZHLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0IsSUFBSSxDQUFDLEtBQUs7UUFBRSxPQUFPLENBQUMsZ0JBQWdCO0lBQ3BDLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNiLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQztJQUN2QixHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRXRCLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7SUFDekIsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxPQUFPLENBQUM7SUFFbkMsU0FBUyxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLE1BQU0sQ0FBQyxDQUFDO0FBQ3ZGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB1aURpciA9IHJlcXVpcmUoXCIuLi9jb25maWcuanNvblwiKS5zcHJOYW1lO1xyXG5jb25zdCBwYXRoc3RyID0gcGF0aC5qb2luKEVkaXRvci5Qcm9qZWN0LnBhdGgsIHVpRGlyKTtcclxuXHJcbnZhciBVSUxvZ2ljRGljdDogeyBbazogc3RyaW5nXTogYW55IH0gPSB7fTtcclxudmFyIFVJQ2xhc3NEaWN0OiB7IFtrOiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG52YXIgaW1wb3J0QXJyID0gW107XHJcblxyXG4vKipcclxuICog5bCGRXhjZWzmlofku7bovazmjaLkuLpKU09O5qC85byPXHJcbiAqIEBwYXJhbSBleGNlbFBhdGggRXhjZWzmlofku7bot6/lvoRcclxuICogQHBhcmFtIG91dHB1dERpciDovpPlh7rnm67lvZVcclxuICogQHJldHVybnMg6L2s5o2i57uT5p6cXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlU3ByKCkge1xyXG4gICAgaW1wb3J0QXJyID0gW107XHJcbiAgICBpbXBvcnRBcnIgPSBbYGltcG9ydCB7IFVJQ2xhc3MgfSBmcm9tICcuL2Fzc2V0cy9hcHBETC9NYW5hZ2VyL1VJQ2xhc3MnO1xcbmBdO1xyXG4gICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gZnMucmVhZGRpclN5bmMocGF0aHN0cik7XHJcbiAgICBmaWxlcy5tYXAoZmlsZXBhciA9PiB7XHJcbiAgICAgICAgaWYgKCFmaWxlcGFyLmVuZHNXaXRoKCcubWV0YScpKSB7XHJcbiAgICAgICAgICAgIGlmIChmaWxlcGFyLnNwbGl0KCcuJylbMV0gPT0gJ3RzJykge1xyXG4gICAgICAgICAgICAgICAgcmVhZFRzKCcnLCBmaWxlcGFyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCBmaWxlc1Bhcjogc3RyaW5nW10gPSBmcy5yZWFkZGlyU3luYyhwYXRoc3RyICsgJy8nICsgZmlsZXBhcik7XHJcbiAgICAgICAgICAgICAgICBmaWxlc1Bhci5mb3JFYWNoKGZpbGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLmluZGV4T2YoJy5tZXRhJykgPT0gLTEgJiYgZmlsZS5pbmRleE9mKCcudHMnKSAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkVHMoZmlsZXBhciwgZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgdHMgPSBpbXBvcnRBcnIuam9pbihcIlwiKVxyXG4gICAgdHMgKz0gYFxyXG5pbnRlcmZhY2UgVUlDbGFzc0RpY3QgeyB9XHJcbmBcclxuICAgIGZvciAodmFyIGNsYXNzTmFtZSBpbiBVSUxvZ2ljRGljdCkge1xyXG4gICAgICAgIHRzICs9IGBpbnRlcmZhY2UgJHtjbGFzc05hbWV9Q2xhc3MgZXh0ZW5kcyBVSUNsYXNzIHtcclxuICAgIHVpU2NyOiAke1VJTG9naWNEaWN0W2NsYXNzTmFtZV19XHJcbn1cclxuYFxyXG4gICAgfVxyXG4gICAgdHMgKz0gYFxyXG5pbnRlcmZhY2UgVUlDbGFzc0RpY3Qge1xyXG5gXHJcbiAgICBmb3IgKHZhciBiYXNlTmFtZSBpbiBVSUNsYXNzRGljdCkge1xyXG4gICAgICAgIHRzICs9IGAgICAgJHtiYXNlTmFtZX06ICR7VUlDbGFzc0RpY3RbYmFzZU5hbWVdfVxcbmBcclxuICAgIH1cclxuICAgIHRzICs9IGB9YFxyXG4gICAgbGV0IHB0ID0gcGF0aC5qb2luKEVkaXRvci5Qcm9qZWN0LnBhdGgsICd0eXBlX3Nwci5kLnRzJylcclxuICAgIGZzLndyaXRlRmlsZVN5bmMocHQsIHRzKTtcclxufVxyXG5mdW5jdGlvbiByZWFkVHMocGFyOiBzdHJpbmcsIHRzTmFtZTogc3RyaW5nKSB7XHJcbiAgICBsZXQgbmFtZSA9IHRzTmFtZS5zcGxpdCgnLicpWzBdO1xyXG4gICAgbGV0IGZpbGVOYW1lID0gXCJcIjtcclxuICAgIGlmIChwYXIgPT0gJycpIHtcclxuICAgICAgICBmaWxlTmFtZSA9ICcvJyArIHRzTmFtZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZmlsZU5hbWUgPSAnLycgKyBwYXIgKyAnLycgKyB0c05hbWU7XHJcbiAgICB9XHJcbiAgICBsZXQgc3RyID0gZnMucmVhZEZpbGVTeW5jKHBhdGhzdHIgKyBcIi9cIiArIGZpbGVOYW1lLCAndXRmLTgnKTtcclxuICAgIC8vIOWPquWkhOeQhue7p+aJvyBVSVNjciDnmoTnsbtcclxuICAgIGNvbnN0IGNsYXNzUmVnID0gL2V4cG9ydFxccysoPzpkZWZhdWx0XFxzKyk/KD86YWJzdHJhY3RcXHMrKT9jbGFzc1xccysoXFx3KylcXHMrZXh0ZW5kc1xccytVSVNjcig/OjxbXj5dKz4pPy87XHJcbiAgICBsZXQgbWF0Y2ggPSBjbGFzc1JlZy5leGVjKHN0cik7XHJcbiAgICBpZiAoIW1hdGNoKSByZXR1cm47IC8v5LiN57un5om/IFVJU2NyIOebtOaOpemAgOWHulxyXG4gICAgdmFyIGFyciA9IFtdO1xyXG4gICAgdmFyIFVJTG9naWNOYW1lID0gbmFtZTtcclxuICAgIGFyci5wdXNoKFVJTG9naWNOYW1lKTtcclxuXHJcbiAgICBVSUxvZ2ljRGljdFtuYW1lXSA9IG5hbWU7XHJcbiAgICBVSUNsYXNzRGljdFtuYW1lXSA9IG5hbWUgKyBcIkNsYXNzXCI7XHJcblxyXG4gICAgaW1wb3J0QXJyLnB1c2goYGltcG9ydCB7ICR7YXJyLmpvaW4oJywgJyl9IH0gZnJvbSAnLi8ke3VpRGlyfS8ke3Bhcn0vJHtuYW1lfSc7XFxuYCk7XHJcbn0iXX0=