"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.xlsxToBinary = xlsxToBinary;
// excel-to-binary-simplified.ts
const fs = require("fs");
const path = require("path");
const xlsx = require("xlsx");
function xlsxToBinary(excelPath, outputDir) {
    // 确保输出目录存在
    if (!fs.existsSync(outputDir)) {
        fs.mkdirSync(outputDir, { recursive: true });
    }
    const files = fs.readdirSync(excelPath);
    const generatedFiles = [];
    const typeInfos = [];
    // 类型转换函数
    const convertValue = (type, value) => {
        if (value === undefined || value === null || value === '') {
            if (type.startsWith('array1'))
                return [];
            if (type.startsWith('array2'))
                return [];
            if (type.startsWith('kv'))
                return {};
            if (type === 'int')
                return 0;
            return '';
        }
        const typeLower = type.toLowerCase();
        const valueStr = value.toString().trim();
        // 处理一维数组类型
        if (typeLower.startsWith('array1<')) {
            const match = typeLower.match(/array1<([^>]+)>/);
            if (!match)
                return [];
            const inner = match[1];
            if (!valueStr)
                return [];
            return valueStr.split(',').map(v => convertValue(inner, v.trim()));
        }
        // 处理二维数组类型
        if (typeLower.startsWith('array2<')) {
            const match = typeLower.match(/array2<([^>]+)>/);
            if (!match)
                return [];
            const inner = match[1];
            if (!valueStr)
                return [];
            if (valueStr.includes(';') || valueStr.includes('|')) {
                const sep = valueStr.includes(';') ? ';' : '|';
                return valueStr.split(sep).map(row => row.split(',').map(v => convertValue(inner, v.trim())));
            }
            if (valueStr.includes(',')) {
                return [valueStr.split(',').map(v => convertValue(inner, v.trim()))];
            }
            return [[convertValue(inner, valueStr)]];
        }
        // 处理kv类型
        if (typeLower.startsWith('kv<')) {
            const match = typeLower.match(/kv<([^>]+)>/);
            if (!match)
                return {};
            const inner = match[1];
            const kvPairs = valueStr.split(',');
            const result = {};
            kvPairs.forEach(pair => {
                const [key, val] = pair.split(':').map(s => s.trim());
                if (key && val !== undefined) {
                    result[key] = convertValue(inner, val);
                }
            });
            return result;
        }
        // 基本类型处理
        switch (typeLower) {
            case 'int':
                return Number.isInteger(value) ? value : parseInt(valueStr, 10) || 0;
            case 'string':
                return valueStr;
            case 'array1': {
                if (!valueStr)
                    return [];
                return valueStr.split(',').map(item => {
                    const trimmed = item.trim();
                    const numVal = parseFloat(trimmed);
                    return isNaN(numVal) ? trimmed : numVal;
                });
            }
            case 'array2': {
                if (!valueStr)
                    return [];
                if (valueStr.includes(';') || valueStr.includes('|')) {
                    const sep = valueStr.includes(';') ? ';' : '|';
                    return valueStr.split(sep).map(row => row.split(',').map(v => {
                        const trimmed = v.trim();
                        const numVal = parseFloat(trimmed);
                        return isNaN(numVal) ? trimmed : numVal;
                    }));
                }
                if (valueStr.includes(',')) {
                    return [valueStr.split(',').map(v => {
                            const trimmed = v.trim();
                            const numVal = parseFloat(trimmed);
                            return isNaN(numVal) ? trimmed : numVal;
                        })];
                }
                return [[value]];
            }
            case 'kv': {
                const result = {};
                valueStr.split(',').forEach(pair => {
                    const [key, val] = pair.split(':').map(s => s.trim());
                    if (key && val !== undefined) {
                        const numVal = parseFloat(val);
                        result[key] = isNaN(numVal) ? val : numVal;
                    }
                });
                return result;
            }
            default:
                return value;
        }
    };
    // 转换为TypeScript类型
    const convertToTsType = (type) => {
        if (!type)
            return 'any';
        const typeLower = type.toLowerCase();
        if (typeLower === 'int')
            return 'number';
        if (typeLower === 'string')
            return 'string';
        if (typeLower.startsWith('array1'))
            return 'any[]';
        if (typeLower.startsWith('array2'))
            return 'any[][]';
        if (typeLower.startsWith('kv'))
            return '{ [key: string]: any }';
        return 'any';
    };
    // 处理每个Excel文件
    files.forEach(file => {
        if (!/\.(xlsx|xls)$/i.test(path.extname(file)))
            return;
        const filePath = path.join(`${excelPath}`, `${file}`);
        const workbook = xlsx.readFile(filePath);
        // @ts-ignore
        workbook.SheetNames.forEach(sheetName => {
            const worksheet = workbook.Sheets[sheetName];
            const rows = xlsx.utils.sheet_to_json(worksheet, { header: 1 });
            if (!rows || rows.length === 0) {
                console.warn(`工作表 ${sheetName} 没有数据，跳过处理`);
                return;
            }
            let jsonData = null;
            let keys = [];
            let types = [];
            let fieldComments = [];
            // 判断表格格式：竖式或横式
            if (rows[0][0] === 'id' || rows[0][0] === 'lid') {
                // 竖式表格
                if (rows.length < 4) {
                    console.warn(`工作表 ${sheetName} 数据不足，跳过处理`);
                    return;
                }
                keys = rows[0];
                types = rows[1].map((t) => t ? t.toString().toLowerCase() : 'string');
                fieldComments = rows[2].map((c) => c ? c.toString() : '');
                jsonData = [];
                for (let i = 3; i < rows.length; i++) {
                    const row = rows[i];
                    const obj = {};
                    if (row[0] !== undefined) {
                        for (let j = 0; j < keys.length; j++) {
                            obj[keys[j]] = convertValue(types[j], row[j]);
                        }
                        jsonData.push(obj);
                    }
                }
            }
            else {
                // 横式表格
                jsonData = {};
                keys = [];
                types = [];
                fieldComments = [];
                rows.forEach(row => {
                    if (row.length < 4)
                        return;
                    const key = row[0];
                    const type = row[1] ? row[1].toString().toLowerCase() : 'string';
                    const comment = row[2] ? row[2].toString() : '';
                    keys.push(key);
                    types.push(type);
                    fieldComments.push(comment);
                    const data = row.slice(3);
                    if (data.length === 1) {
                        jsonData[key] = convertValue(type, data[0]);
                    }
                    else {
                        jsonData[key] = data.map(v => convertValue(type, v));
                    }
                });
            }
            // 生成二进制文件（简化版，只包含数据）
            const binaryFileName = `${sheetName}.bin`;
            const binaryOutputFile = path.join(`${outputDir}`, binaryFileName);
            // 直接序列化数据为二进制
            generateSimpleBinaryFile(jsonData, binaryOutputFile);
            generatedFiles.push(binaryOutputFile);
            console.log(`转换成功: ${sheetName}.bin`);
            // 收集类型信息
            typeInfos.push({
                name: sheetName,
                fields: keys.map((key, index) => ({
                    key,
                    tsType: convertToTsType(types[index]),
                    comment: fieldComments[index] || ''
                }))
            });
        });
    });
    // 生成类型定义文件
    if (typeInfos.length > 0) {
        generateTypeDefinition(typeInfos);
    }
}
// 简化版：只存储序列化后的JSON数据
function generateSimpleBinaryFile(data, outputPath) {
    // 将数据序列化为JSON字符串
    const jsonString = JSON.stringify(data);
    // 转换为Buffer
    const buffer = Buffer.from(jsonString, 'utf8');
    // 写入文件
    fs.writeFileSync(outputPath, buffer);
}
// 生成TypeScript类型定义文件
function generateTypeDefinition(list) {
    const lines = [];
    lines.push("// 自动生成的配置类型定义，请勿手动修改\n");
    lines.push("/** 通用配置查询接口 */");
    lines.push("interface ConfigFunc<T> {");
    lines.push("   get(value?: any, key?: string): T;");
    lines.push("   getAll(): T[];");
    lines.push("}\n");
    lines.push("interface configType {");
    list.forEach(info => {
        const key = info.name.charAt(0).toLowerCase() + info.name.slice(1);
        lines.push(`    ${key}?: ConfigFunc<${info.name}Config>;`);
    });
    lines.push("}\n");
    // 生成每个配置表的接口
    list.forEach(info => {
        lines.push(`interface ${info.name}Config {`);
        info.fields.forEach(field => {
            if (field.comment) {
                lines.push(`    /** ${field.comment} */`);
            }
            lines.push(`    ${field.key}?: ${field.tsType};`);
        });
        lines.push("}\n");
    });
    const outputFile = path.join(Editor.Project.path, "type_bin.d.ts");
    fs.writeFileSync(outputFile, lines.join("\n"));
    console.log("已生成类型定义文件: type_bin.d.ts");
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieGxzeFRvQmluLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc291cmNlL3hsc3hUb0Jpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQWdCQSxvQ0E2TkM7QUE3T0QsZ0NBQWdDO0FBQ2hDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN6QixNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0IsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBYTdCLFNBQWdCLFlBQVksQ0FBQyxTQUFpQixFQUFFLFNBQWlCO0lBQzdELFdBQVc7SUFDWCxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQzVCLEVBQUUsQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVELE1BQU0sS0FBSyxHQUFhLEVBQUUsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEQsTUFBTSxjQUFjLEdBQWEsRUFBRSxDQUFDO0lBQ3BDLE1BQU0sU0FBUyxHQUFxQixFQUFFLENBQUM7SUFFdkMsU0FBUztJQUNULE1BQU0sWUFBWSxHQUFHLENBQUMsSUFBWSxFQUFFLEtBQVUsRUFBTyxFQUFFO1FBQ25ELElBQUksS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUN4RCxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO2dCQUFFLE9BQU8sRUFBRSxDQUFDO1lBQ3pDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7Z0JBQUUsT0FBTyxFQUFFLENBQUM7WUFDekMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQztnQkFBRSxPQUFPLEVBQUUs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QUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gZXhjZWwtdG8tYmluYXJ5LXNpbXBsaWZpZWQudHNcclxuY29uc3QgZnMgPSByZXF1aXJlKFwiZnNcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgeGxzeCA9IHJlcXVpcmUoXCJ4bHN4XCIpO1xyXG5cclxuaW50ZXJmYWNlIENvbmZpZ0ZpZWxkIHtcclxuICAgIGtleTogc3RyaW5nO1xyXG4gICAgdHNUeXBlOiBzdHJpbmc7XHJcbiAgICBjb21tZW50OiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBDb25maWdUeXBlSW5mbyB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBmaWVsZHM6IENvbmZpZ0ZpZWxkW107XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB4bHN4VG9CaW5hcnkoZXhjZWxQYXRoOiBzdHJpbmcsIG91dHB1dERpcjogc3RyaW5nKSB7XHJcbiAgICAvLyDnoa7kv53ovpPlh7rnm67lvZXlrZjlnKhcclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhvdXRwdXREaXIpKSB7XHJcbiAgICAgICAgZnMubWtkaXJTeW5jKG91dHB1dERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gZnMucmVhZGRpclN5bmMoZXhjZWxQYXRoKTtcclxuICAgIGNvbnN0IGdlbmVyYXRlZEZpbGVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgdHlwZUluZm9zOiBDb25maWdUeXBlSW5mb1tdID0gW107XHJcblxyXG4gICAgLy8g57G75Z6L6L2s5o2i5Ye95pWwXHJcbiAgICBjb25zdCBjb252ZXJ0VmFsdWUgPSAodHlwZTogc3RyaW5nLCB2YWx1ZTogYW55KTogYW55ID0+IHtcclxuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGUuc3RhcnRzV2l0aCgnYXJyYXkxJykpIHJldHVybiBbXTtcclxuICAgICAgICAgICAgaWYgKHR5cGUuc3RhcnRzV2l0aCgnYXJyYXkyJykpIHJldHVybiBbXTtcclxuICAgICAgICAgICAgaWYgKHR5cGUuc3RhcnRzV2l0aCgna3YnKSkgcmV0dXJuIHt9O1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2ludCcpIHJldHVybiAwO1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0eXBlTG93ZXI6IHN0cmluZyA9IHR5cGUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBjb25zdCB2YWx1ZVN0cjogc3RyaW5nID0gdmFsdWUudG9TdHJpbmcoKS50cmltKCk7XHJcblxyXG4gICAgICAgIC8vIOWkhOeQhuS4gOe7tOaVsOe7hOexu+Wei1xyXG4gICAgICAgIGlmICh0eXBlTG93ZXIuc3RhcnRzV2l0aCgnYXJyYXkxPCcpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdHlwZUxvd2VyLm1hdGNoKC9hcnJheTE8KFtePl0rKT4vKTtcclxuICAgICAgICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICBjb25zdCBpbm5lcjogc3RyaW5nID0gbWF0Y2hbMV07XHJcbiAgICAgICAgICAgIGlmICghdmFsdWVTdHIpIHJldHVybiBbXTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlU3RyLnNwbGl0KCcsJykubWFwKHYgPT4gY29udmVydFZhbHVlKGlubmVyLCB2LnRyaW0oKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlpITnkIbkuoznu7TmlbDnu4TnsbvlnotcclxuICAgICAgICBpZiAodHlwZUxvd2VyLnN0YXJ0c1dpdGgoJ2FycmF5MjwnKSkge1xyXG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IHR5cGVMb3dlci5tYXRjaCgvYXJyYXkyPChbXj5dKyk+Lyk7XHJcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBbXTtcclxuICAgICAgICAgICAgY29uc3QgaW5uZXI6IHN0cmluZyA9IG1hdGNoWzFdO1xyXG4gICAgICAgICAgICBpZiAoIXZhbHVlU3RyKSByZXR1cm4gW107XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZVN0ci5pbmNsdWRlcygnOycpIHx8IHZhbHVlU3RyLmluY2x1ZGVzKCd8JykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlcCA9IHZhbHVlU3RyLmluY2x1ZGVzKCc7JykgPyAnOycgOiAnfCc7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVTdHIuc3BsaXQoc2VwKS5tYXAocm93ID0+XHJcbiAgICAgICAgICAgICAgICAgICAgcm93LnNwbGl0KCcsJykubWFwKHYgPT4gY29udmVydFZhbHVlKGlubmVyLCB2LnRyaW0oKSkpXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZVN0ci5pbmNsdWRlcygnLCcpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW3ZhbHVlU3RyLnNwbGl0KCcsJykubWFwKHYgPT4gY29udmVydFZhbHVlKGlubmVyLCB2LnRyaW0oKSkpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gW1tjb252ZXJ0VmFsdWUoaW5uZXIsIHZhbHVlU3RyKV1dO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlpITnkIZrduexu+Wei1xyXG4gICAgICAgIGlmICh0eXBlTG93ZXIuc3RhcnRzV2l0aCgna3Y8JykpIHtcclxuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSB0eXBlTG93ZXIubWF0Y2goL2t2PChbXj5dKyk+Lyk7XHJcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiB7fTtcclxuICAgICAgICAgICAgY29uc3QgaW5uZXI6IHN0cmluZyA9IG1hdGNoWzFdO1xyXG4gICAgICAgICAgICBjb25zdCBrdlBhaXJzOiBzdHJpbmdbXSA9IHZhbHVlU3RyLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG4gICAgICAgICAgICBrdlBhaXJzLmZvckVhY2gocGFpciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBba2V5LCB2YWxdID0gcGFpci5zcGxpdCgnOicpLm1hcChzID0+IHMudHJpbSgpKTtcclxuICAgICAgICAgICAgICAgIGlmIChrZXkgJiYgdmFsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IGNvbnZlcnRWYWx1ZShpbm5lciwgdmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDln7rmnKznsbvlnovlpITnkIZcclxuICAgICAgICBzd2l0Y2ggKHR5cGVMb3dlcikge1xyXG4gICAgICAgICAgICBjYXNlICdpbnQnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIodmFsdWUpID8gdmFsdWUgOiBwYXJzZUludCh2YWx1ZVN0ciwgMTApIHx8IDA7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVTdHI7XHJcbiAgICAgICAgICAgIGNhc2UgJ2FycmF5MSc6IHtcclxuICAgICAgICAgICAgICAgIGlmICghdmFsdWVTdHIpIHJldHVybiBbXTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZVN0ci5zcGxpdCgnLCcpLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmltbWVkID0gaXRlbS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtVmFsID0gcGFyc2VGbG9hdCh0cmltbWVkKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNOYU4obnVtVmFsKSA/IHRyaW1tZWQgOiBudW1WYWw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdhcnJheTInOiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlU3RyKSByZXR1cm4gW107XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVTdHIuaW5jbHVkZXMoJzsnKSB8fCB2YWx1ZVN0ci5pbmNsdWRlcygnfCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VwID0gdmFsdWVTdHIuaW5jbHVkZXMoJzsnKSA/ICc7JyA6ICd8JztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVTdHIuc3BsaXQoc2VwKS5tYXAocm93ID0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5zcGxpdCgnLCcpLm1hcCh2ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSB2LnRyaW0oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bVZhbCA9IHBhcnNlRmxvYXQodHJpbW1lZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNOYU4obnVtVmFsKSA/IHRyaW1tZWQgOiBudW1WYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZVN0ci5pbmNsdWRlcygnLCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFt2YWx1ZVN0ci5zcGxpdCgnLCcpLm1hcCh2ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJpbW1lZCA9IHYudHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1WYWwgPSBwYXJzZUZsb2F0KHRyaW1tZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNOYU4obnVtVmFsKSA/IHRyaW1tZWQgOiBudW1WYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtbdmFsdWVdXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdrdic6IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgdmFsdWVTdHIuc3BsaXQoJywnKS5mb3JFYWNoKHBhaXIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFtrZXksIHZhbF0gPSBwYWlyLnNwbGl0KCc6JykubWFwKHMgPT4gcy50cmltKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgJiYgdmFsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtVmFsID0gcGFyc2VGbG9hdCh2YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IGlzTmFOKG51bVZhbCkgPyB2YWwgOiBudW1WYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDovazmjaLkuLpUeXBlU2NyaXB057G75Z6LXHJcbiAgICBjb25zdCBjb252ZXJ0VG9Uc1R5cGUgPSAodHlwZTogc3RyaW5nKTogc3RyaW5nID0+IHtcclxuICAgICAgICBpZiAoIXR5cGUpIHJldHVybiAnYW55JztcclxuICAgICAgICBjb25zdCB0eXBlTG93ZXIgPSB0eXBlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgaWYgKHR5cGVMb3dlciA9PT0gJ2ludCcpIHJldHVybiAnbnVtYmVyJztcclxuICAgICAgICBpZiAodHlwZUxvd2VyID09PSAnc3RyaW5nJykgcmV0dXJuICdzdHJpbmcnO1xyXG4gICAgICAgIGlmICh0eXBlTG93ZXIuc3RhcnRzV2l0aCgnYXJyYXkxJykpIHJldHVybiAnYW55W10nO1xyXG4gICAgICAgIGlmICh0eXBlTG93ZXIuc3RhcnRzV2l0aCgnYXJyYXkyJykpIHJldHVybiAnYW55W11bXSc7XHJcbiAgICAgICAgaWYgKHR5cGVMb3dlci5zdGFydHNXaXRoKCdrdicpKSByZXR1cm4gJ3sgW2tleTogc3RyaW5nXTogYW55IH0nO1xyXG4gICAgICAgIHJldHVybiAnYW55JztcclxuICAgIH07XHJcblxyXG4gICAgLy8g5aSE55CG5q+P5LiqRXhjZWzmlofku7ZcclxuICAgIGZpbGVzLmZvckVhY2goZmlsZSA9PiB7XHJcbiAgICAgICAgaWYgKCEvXFwuKHhsc3h8eGxzKSQvaS50ZXN0KHBhdGguZXh0bmFtZShmaWxlKSkpIHJldHVybjtcclxuXHJcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oYCR7ZXhjZWxQYXRofWAsIGAke2ZpbGV9YCk7XHJcbiAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSB4bHN4LnJlYWRGaWxlKGZpbGVQYXRoKTtcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgd29ya2Jvb2suU2hlZXROYW1lcy5mb3JFYWNoKHNoZWV0TmFtZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzaGVldCA9IHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdO1xyXG4gICAgICAgICAgICBjb25zdCByb3dzOiBhbnlbXVtdID0geGxzeC51dGlscy5zaGVldF90b19qc29uKHdvcmtzaGVldCwgeyBoZWFkZXI6IDEgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXJvd3MgfHwgcm93cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybihg5bel5L2c6KGoICR7c2hlZXROYW1lfSDmsqHmnInmlbDmja7vvIzot7Pov4flpITnkIZgKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGV0IGpzb25EYXRhOiBhbnkgPSBudWxsO1xyXG4gICAgICAgICAgICBsZXQga2V5czogc3RyaW5nW10gPSBbXTtcclxuICAgICAgICAgICAgbGV0IHR5cGVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgICAgICAgICBsZXQgZmllbGRDb21tZW50czogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWIpOaWreihqOagvOagvOW8j++8muerluW8j+aIluaoquW8j1xyXG4gICAgICAgICAgICBpZiAocm93c1swXVswXSA9PT0gJ2lkJyB8fCByb3dzWzBdWzBdID09PSAnbGlkJykge1xyXG4gICAgICAgICAgICAgICAgLy8g56uW5byP6KGo5qC8XHJcbiAgICAgICAgICAgICAgICBpZiAocm93cy5sZW5ndGggPCA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGDlt6XkvZzooaggJHtzaGVldE5hbWV9IOaVsOaNruS4jei2s++8jOi3s+i/h+WkhOeQhmApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGtleXMgPSByb3dzWzBdO1xyXG4gICAgICAgICAgICAgICAgdHlwZXMgPSByb3dzWzFdLm1hcCgodDogYW55KSA9PiB0ID8gdC50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgOiAnc3RyaW5nJyk7XHJcbiAgICAgICAgICAgICAgICBmaWVsZENvbW1lbnRzID0gcm93c1syXS5tYXAoKGM6IGFueSkgPT4gYyA/IGMudG9TdHJpbmcoKSA6ICcnKTtcclxuICAgICAgICAgICAgICAgIGpzb25EYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDM7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gcm93c1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmo6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocm93WzBdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBrZXlzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpba2V5c1tqXV0gPSBjb252ZXJ0VmFsdWUodHlwZXNbal0sIHJvd1tqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGEucHVzaChvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIOaoquW8j+ihqOagvFxyXG4gICAgICAgICAgICAgICAganNvbkRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgIGtleXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHR5cGVzID0gW107XHJcbiAgICAgICAgICAgICAgICBmaWVsZENvbW1lbnRzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKHJvdyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5sZW5ndGggPCA0KSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gcm93WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSByb3dbMV0gPyByb3dbMV0udG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpIDogJ3N0cmluZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWVudCA9IHJvd1syXSA/IHJvd1syXS50b1N0cmluZygpIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZXMucHVzaCh0eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZENvbW1lbnRzLnB1c2goY29tbWVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByb3cuc2xpY2UoMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25EYXRhW2tleV0gPSBjb252ZXJ0VmFsdWUodHlwZSwgZGF0YVswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGFba2V5XSA9IGRhdGEubWFwKHYgPT4gY29udmVydFZhbHVlKHR5cGUsIHYpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g55Sf5oiQ5LqM6L+b5Yi25paH5Lu277yI566A5YyW54mI77yM5Y+q5YyF5ZCr5pWw5o2u77yJXHJcbiAgICAgICAgICAgIGNvbnN0IGJpbmFyeUZpbGVOYW1lID0gYCR7c2hlZXROYW1lfS5iaW5gO1xyXG4gICAgICAgICAgICBjb25zdCBiaW5hcnlPdXRwdXRGaWxlID0gcGF0aC5qb2luKGAke291dHB1dERpcn1gLCBiaW5hcnlGaWxlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAvLyDnm7TmjqXluo/liJfljJbmlbDmja7kuLrkuozov5vliLZcclxuICAgICAgICAgICAgZ2VuZXJhdGVTaW1wbGVCaW5hcnlGaWxlKGpzb25EYXRhLCBiaW5hcnlPdXRwdXRGaWxlKTtcclxuXHJcbiAgICAgICAgICAgIGdlbmVyYXRlZEZpbGVzLnB1c2goYmluYXJ5T3V0cHV0RmlsZSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDovazmjaLmiJDlip86ICR7c2hlZXROYW1lfS5iaW5gKTtcclxuXHJcbiAgICAgICAgICAgIC8vIOaUtumbhuexu+Wei+S/oeaBr1xyXG4gICAgICAgICAgICB0eXBlSW5mb3MucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBzaGVldE5hbWUsXHJcbiAgICAgICAgICAgICAgICBmaWVsZHM6IGtleXMubWFwKChrZXksIGluZGV4KSA9PiAoe1xyXG4gICAgICAgICAgICAgICAgICAgIGtleSxcclxuICAgICAgICAgICAgICAgICAgICB0c1R5cGU6IGNvbnZlcnRUb1RzVHlwZSh0eXBlc1tpbmRleF0pLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbW1lbnQ6IGZpZWxkQ29tbWVudHNbaW5kZXhdIHx8ICcnXHJcbiAgICAgICAgICAgICAgICB9KSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDnlJ/miJDnsbvlnovlrprkuYnmlofku7ZcclxuICAgIGlmICh0eXBlSW5mb3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGdlbmVyYXRlVHlwZURlZmluaXRpb24odHlwZUluZm9zKTtcclxuICAgIH1cclxufVxyXG5cclxuLy8g566A5YyW54mI77ya5Y+q5a2Y5YKo5bqP5YiX5YyW5ZCO55qESlNPTuaVsOaNrlxyXG5mdW5jdGlvbiBnZW5lcmF0ZVNpbXBsZUJpbmFyeUZpbGUoZGF0YTogYW55LCBvdXRwdXRQYXRoOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIC8vIOWwhuaVsOaNruW6j+WIl+WMluS4ukpTT07lrZfnrKbkuLJcclxuICAgIGNvbnN0IGpzb25TdHJpbmcgPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuXHJcbiAgICAvLyDovazmjaLkuLpCdWZmZXJcclxuICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGpzb25TdHJpbmcsICd1dGY4Jyk7XHJcblxyXG4gICAgLy8g5YaZ5YWl5paH5Lu2XHJcbiAgICBmcy53cml0ZUZpbGVTeW5jKG91dHB1dFBhdGgsIGJ1ZmZlcik7XHJcbn1cclxuXHJcbi8vIOeUn+aIkFR5cGVTY3JpcHTnsbvlnovlrprkuYnmlofku7ZcclxuZnVuY3Rpb24gZ2VuZXJhdGVUeXBlRGVmaW5pdGlvbihsaXN0OiBDb25maWdUeXBlSW5mb1tdKTogdm9pZCB7XHJcbiAgICBjb25zdCBsaW5lczogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICBsaW5lcy5wdXNoKFwiLy8g6Ieq5Yqo55Sf5oiQ55qE6YWN572u57G75Z6L5a6a5LmJ77yM6K+35Yu/5omL5Yqo5L+u5pS5XFxuXCIpO1xyXG4gICAgbGluZXMucHVzaChcIi8qKiDpgJrnlKjphY3nva7mn6Xor6LmjqXlj6MgKi9cIik7XHJcbiAgICBsaW5lcy5wdXNoKFwiaW50ZXJmYWNlIENvbmZpZ0Z1bmM8VD4ge1wiKTtcclxuICAgIGxpbmVzLnB1c2goXCIgICBnZXQodmFsdWU/OiBhbnksIGtleT86IHN0cmluZyk6IFQ7XCIpO1xyXG4gICAgbGluZXMucHVzaChcIiAgIGdldEFsbCgpOiBUW107XCIpO1xyXG4gICAgbGluZXMucHVzaChcIn1cXG5cIik7XHJcblxyXG4gICAgbGluZXMucHVzaChcImludGVyZmFjZSBjb25maWdUeXBlIHtcIik7XHJcbiAgICBsaXN0LmZvckVhY2goaW5mbyA9PiB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gaW5mby5uYW1lLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgaW5mby5uYW1lLnNsaWNlKDEpO1xyXG4gICAgICAgIGxpbmVzLnB1c2goYCAgICAke2tleX0/OiBDb25maWdGdW5jPCR7aW5mby5uYW1lfUNvbmZpZz47YCk7XHJcbiAgICB9KTtcclxuICAgIGxpbmVzLnB1c2goXCJ9XFxuXCIpO1xyXG5cclxuICAgIC8vIOeUn+aIkOavj+S4qumFjee9ruihqOeahOaOpeWPo1xyXG4gICAgbGlzdC5mb3JFYWNoKGluZm8gPT4ge1xyXG4gICAgICAgIGxpbmVzLnB1c2goYGludGVyZmFjZSAke2luZm8ubmFtZX1Db25maWcge2ApO1xyXG4gICAgICAgIGluZm8uZmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZmllbGQuY29tbWVudCkge1xyXG4gICAgICAgICAgICAgICAgbGluZXMucHVzaChgICAgIC8qKiAke2ZpZWxkLmNvbW1lbnR9ICovYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGluZXMucHVzaChgICAgICR7ZmllbGQua2V5fT86ICR7ZmllbGQudHNUeXBlfTtgKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsaW5lcy5wdXNoKFwifVxcblwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IG91dHB1dEZpbGUgPSBwYXRoLmpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgXCJ0eXBlX2Jpbi5kLnRzXCIpO1xyXG4gICAgZnMud3JpdGVGaWxlU3luYyhvdXRwdXRGaWxlLCBsaW5lcy5qb2luKFwiXFxuXCIpKTtcclxuICAgIGNvbnNvbGUubG9nKFwi5bey55Sf5oiQ57G75Z6L5a6a5LmJ5paH5Lu2OiB0eXBlX2Jpbi5kLnRzXCIpO1xyXG59Il19